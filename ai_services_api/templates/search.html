<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantic Search Recommendations</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-gray-100">
    <div class="container mx-auto py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-center">Semantic Search</h1>
            <p class="text-center text-gray-400 mt-2">Find relevant results quickly</p>
        </header>

        <main>
            <div class="max-w-3xl mx-auto">
                <div class="bg-gray-800 rounded-lg shadow-md p-6 border border-gray-700 mb-6">
                    <form id="search-form" class="space-y-4">
                        <div>
                            <label for="search-input" class="block mb-2 font-medium">Enter your query:</label>
                            <input 
                                type="text" 
                                id="search-input"
                                name="query" 
                                class="bg-gray-700 text-gray-100 rounded-md px-4 py-2 w-full"
                                placeholder="Enter your semantic search query..."
                                required
                            >
                        </div>
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-medium px-4 py-2 rounded-md w-full">Search</button>
                    </form>
                </div>

                <!-- Results section -->
                <div id="results-container" class="space-y-4"></div>
                
                <!-- Loading indicator -->
                <div id="loading" class="hidden">
                    <p class="text-center text-gray-400">Searching...</p>
                </div>
                
                <!-- Error message -->
                <div id="error" class="hidden bg-red-900 text-white p-4 rounded-md mt-4"></div>
            </div>
        </main>

        <footer class="mt-8 text-center text-gray-400">
            <p>&copy; 2024 Semantic Search System</p>
        </footer>
    </div>

    <script>
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const resultsContainer = document.getElementById('results-container');
        const loadingElement = document.getElementById('loading');
        const errorElement = document.getElementById('error');

        searchForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const query = searchInput.value.trim();
            
            if (!query) return;

            // Show loading, hide error
            loadingElement.classList.remove('hidden');
            errorElement.classList.add('hidden');
            resultsContainer.innerHTML = '';

            try {
                // Updated endpoint URL
                const response = await fetch(`/search/search/?query=${encodeURIComponent(query)}&limit=5`);
                if (!response.ok) throw new Error('Search failed');
                
                const results = await response.json();
                displayResults(results);
            } catch (err) {
                console.error('Search error:', err);
                errorElement.textContent = 'Failed to perform search. Please try again.';
                errorElement.classList.remove('hidden');
            } finally {
                loadingElement.classList.add('hidden');
            }
        });

        function displayResults(results) {
            resultsContainer.innerHTML = '';
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="bg-gray-800 rounded-lg p-6 text-center text-gray-400">
                        No results found
                    </div>
                `;
                return;
            }

            results.forEach(result => {
                const resultElement = document.createElement('div');
                resultElement.className = 'bg-gray-800 rounded-lg p-6 border border-gray-700';
                
                resultElement.innerHTML = `
                    <h3 class="text-xl font-semibold mb-2">${result.title}</h3>
                    
                    ${result.authors ? `
                        <p class="text-gray-400 mb-2">
                            <span class="font-medium">Authors:</span> ${result.authors}
                        </p>
                    ` : ''}
                    
                    ${result.tags ? `
                        <p class="text-gray-400 mb-2">
                            <span class="font-medium">Tags:</span> ${result.tags}
                        </p>
                    ` : ''}
                    
                    ${result.abstract ? `
                        <div class="mb-4">
                            <h4 class="font-medium text-gray-300">Abstract:</h4>
                            <p class="text-gray-400">${result.abstract}</p>
                        </div>
                    ` : ''}
                    
                    ${result.summary ? `
                        <div class="mb-4">
                            <h4 class="font-medium text-gray-300">Summary:</h4>
                            <p class="text-gray-400">${result.summary}</p>
                        </div>
                    ` : ''}
                    
                    <div class="text-right text-sm text-gray-400">
                        Similarity Score: ${(result.similarity_score * 100).toFixed(1)}%
                    </div>
                `;
                
                resultsContainer.appendChild(resultElement);
            });
        }
    </script>
</body>
</html>